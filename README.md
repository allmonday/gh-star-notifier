# GitHub Star Notifier

Receive push notifications when your GitHub repositories are starred.

## Features

- ğŸ”” **Push Notifications**: Get instant notifications when someone stars your repository
- ğŸ”’ **Secure Webhook Verification**: HMAC-SHA256 signature validation
- ğŸ“‹ **Repository Whitelist**: Only allow configured repositories
- ğŸŒ **PWA Support**: Install as a native app on supported devices
- ğŸ§ª **Test Notifications**: Send test notifications to verify setup
- ğŸ’¾ **Persistent Storage**: SQLite database for subscription management

## Architecture

```
GitHub Webhook â†’ Backend (FastAPI) â†’ Push Service â†’ Browser (PWA)
                      â†“
                 SQLite Database
```

## Tech Stack

- **Backend**: FastAPI + Python 3.11
- **Frontend**: Quasar Framework (Vue 3) + PWA
- **Push Protocol**: Web Push API + VAPID
- **Database**: SQLite
- **Deployment**: Docker Compose

## Quick Start

### Prerequisites

- Docker and Docker Compose
- (Optional) Node.js 18+ for local development
- (Optional) Python 3.11+ for local development

### 1. Clone the Repository

```bash
git clone <your-repo-url>
cd github-star-notifier
```

### 2. Configure Environment

```bash
# Copy example environment file
cp .env.example .env

# Generate VAPID keys
python backend/generate_vapid_keys.py --save

# Edit .env and add remaining configuration
nano .env
```

Required environment variables:

```bash
# VAPID Keys (auto-generated by the script above)
VAPID_PRIVATE_KEY=your_vapid_private_key_here
VAPID_PUBLIC_KEY=your_vapid_public_key_here
VAPID_SUBJECT=mailto:your-email@example.com

# GitHub Webhook Secret (generate with: openssl rand -hex 32)
WEBHOOK_SECRET=your_webhook_secret_here

# Repository Whitelist (JSON array of allowed repositories)
WEBHOOK_WHITELIST=["owner/repo1", "owner/repo2"]
```

**ğŸ’¡ Tip**: The VAPID keys are automatically generated and saved to your `.env` files by running:
```bash
python backend/generate_vapid_keys.py --save
```

Or generate them manually at https://vapidkeys.com/

### 3. Start with Docker Compose

```bash
docker-compose up -d
```

The application will be available at:
- Frontend: http://localhost:5173
- Backend API: http://localhost:8000
- API Documentation: http://localhost:8000/docs

### 4. Subscribe to Notifications

1. Open http://localhost:5173 in your browser
2. Click "Subscribe to Notifications"
3. Grant permission when prompted

### 5. Configure GitHub Webhook

1. Go to your repository settings on GitHub
2. Navigate to **Settings** â†’ **Webhooks** â†’ **Add webhook**
3. Configure the webhook:
   - **Payload URL**: `https://your-domain.com/api/webhook`
   - **Content type**: `application/json`
   - **Secret**: Your `WEBHOOK_SECRET` value
   - **Events**: Select "Stars" â†’ "Watch events"
4. Click "Add webhook"

## Local Development (without Docker)

### Backend

```bash
cd backend

# Create virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Copy and edit environment file
cp .env.example .env

# Run the server
python main.py
```

The backend will start at http://localhost:8000

### Frontend

```bash
cd frontend

# Install dependencies
npm install

# Start development server
npm run dev
```

The frontend will start at http://localhost:8080

## API Endpoints

### Public Endpoints

- `GET /` - API information
- `GET /health` - Health check

### Subscription Management

- `GET /api/vapid-public-key` - Get VAPID public key
- `POST /api/subscribe` - Subscribe to push notifications
- `POST /api/unsubscribe` - Unsubscribe from push notifications
- `GET /api/subscriptions` - Get all active subscriptions

### Notifications

- `POST /api/test-notification` - Send a test notification
- `POST /api/webhook` - GitHub webhook endpoint

## GitHub Webhook Payload

The application expects the following GitHub webhook payload:

```json
{
  "action": "started",
  "repository": {
    "id": 123456789,
    "name": "my-repo",
    "full_name": "owner/my-repo",
    "description": "A cool repository",
    "html_url": "https://github.com/owner/my-repo",
    "stargazers_count": 42,
    "owner": {
      "login": "owner",
      "avatar_url": "https://github.com/owner.png"
    }
  },
  "sender": {
    "login": "user",
    "avatar_url": "https://github.com/user.png"
  },
  "starred_at": "2025-01-15T12:34:56Z"
}
```

## Security

### HMAC Verification

The application verifies GitHub webhook signatures using HMAC-SHA256:

1. GitHub sends a signature in the `X-Hub-Signature-256` header
2. The application computes the expected signature using `WEBHOOK_SECRET`
3. Signatures are compared using constant-time comparison
4. Invalid signatures are rejected with HTTP 403

### Whitelist

Only repositories in the `WEBHOOK_WHITELIST` can trigger notifications. Configure this in your `.env` file:

```bash
WEBHOOK_WHITELIST=["owner/repo1", "owner/repo2"]
```

## Deployment

### Production Deployment with Caddy

Since you have Caddy and DDNS configured, you can expose the application on port 5173.

#### Caddyfile Example

```
your-domain.com {
    reverse_proxy localhost:5173
}
```

#### Docker Compose Override

Create `docker-compose.override.yml`:

```yaml
version: '3.8'

services:
  frontend:
    ports:
      - "5173:80"

  backend:
    ports:
      - "8000:8000"
```

Then start with:

```bash
docker-compose up -d
```

### SSL/HTTPS

Web Push API requires HTTPS. Configure Caddy to automatically obtain Let's Encrypt certificates:

```
your-domain.com {
    reverse_proxy localhost:5173

    # Caddy automatically handles HTTPS
}
```

## Troubleshooting

### Notifications Not Received

1. Check browser permissions: Ensure notifications are allowed
2. Check browser console: Look for errors in the developer console
3. Verify subscription: Check the subscription status on the main page
4. Test notification: Use the "Send Test Notification" button

### Webhook Not Triggering

1. Check GitHub webhook delivery logs in repository settings
2. Verify webhook secret matches `WEBHOOK_SECRET`
3. Check repository is in `WEBHOOK_WHITELIST`
4. Check backend logs: `docker-compose logs backend`

### Service Worker Issues

1. Unregister old service workers:
   - Open DevTools â†’ Application â†’ Service Workers
   - Unregister all service workers
2. Clear site data and refresh
3. Check `/sw.js` is being served correctly

### Browser Compatibility

| Browser | Support |
|---------|---------|
| Chrome (Desktop) | âœ… Full support |
| Firefox (Desktop) | âœ… Full support |
| Chrome (Android) | âœ… Full support |
| Safari (iOS 16.4+) | âš ï¸ Limited support |
| Safari (macOS) | âŒ Not supported |
| Edge (Windows) | âŒ WNS, not VAPID |

## Project Structure

```
github-star-notifier/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py                 # FastAPI application
â”‚   â”œâ”€â”€ database.py             # SQLite database manager
â”‚   â”œâ”€â”€ push_service.py         # Push notification service
â”‚   â”œâ”€â”€ webhook_handler.py      # GitHub webhook handler
â”‚   â”œâ”€â”€ models.py               # Pydantic models
â”‚   â”œâ”€â”€ requirements.txt        # Python dependencies
â”‚   â”œâ”€â”€ Dockerfile              # Docker image for backend
â”‚   â””â”€â”€ .env.example            # Environment variables template
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ manifest.json       # PWA manifest
â”‚   â”‚   â””â”€â”€ sw.js               # Service Worker
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/IndexPage.vue # Main page
â”‚   â”‚   â”œâ”€â”€ composables/usePushNotification.js
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ quasar.config.js
â”‚   â”œâ”€â”€ Dockerfile              # Docker image for frontend
â”‚   â””â”€â”€ nginx.conf              # Nginx configuration
â”œâ”€â”€ docker-compose.yml          # Docker Compose configuration
â”œâ”€â”€ .env.example                # Environment variables template
â””â”€â”€ README.md                   # This file
```

## License

MIT

## Author

tangkikodo
